<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Khyber Traders - Wholesale Veterinary Pharmacy. Specialized in Dairy and Cattle Industry solutions.">
    
    <!-- SOCIAL SHARE PREVIEW -->
    <meta property="og:title" content="Khyber Traders | Wholesale Veterinary Pharmacy">
    <meta property="og:description" content="Authentic Medicines for the Modern Dairy Industry. Click to view our inventory.">
    <meta property="og:image" content="https://tahirqadri88.github.io/khybertraders/images/website%20banner.jpg"> 
    <meta property="og:url" content="https://animalhealth.pk">
    <meta property="og:type" content="website">

    <title>Khyber Traders | Wholesale Veterinary Pharmacy</title>
    
    <!-- TRACKING (GA4: G-GZN53B9YMP) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GZN53B9YMP"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-GZN53B9YMP');
    </script>

    <!-- DOMAIN TRAFFIC CONTROLLER -->
    <script>
        if (window.location.hostname.includes('khybertraders.com.pk')) {
            window.location.replace("https://animalhealth.pk" + window.location.search);
        }
    </script>

    <!-- Premium Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;700&family=Playfair+Display:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Manrope"', 'sans-serif'], serif: ['"Playfair Display"', 'serif'] },
                    colors: { brand: { maroon: '#500000', gold: '#D4AF37', dark: '#0a0a0a', light: '#f4f4f5' } },
                    backgroundImage: { 'hero-gradient': "linear-gradient(to bottom, rgba(0,0,0,0.7), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1570042225831-d98fa7577f1e?ixlib=rb-1.2.1&auto=format&fit=crop&w=1920&q=80')" },
                    boxShadow: { 'sleek': '0 4px 20px -2px rgba(0, 0, 0, 0.1)', 'glow': '0 0 15px rgba(212, 175, 55, 0.3)' }
                }
            }
        }
    </script>
    <style>
        .fade-in { animation: fadeIn 1s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #500000; border-radius: 4px; }
        .slider-wrapper { position: relative; width: 100%; height: 100%; overflow: hidden; background: #fff; cursor: zoom-in; }
        .slide { display: none; width: 100%; height: 100%; object-fit: contain; }
        .slide.active { display: block; animation: fadeEffect 0.5s; }
        @keyframes fadeEffect { from {opacity: .4} to {opacity: 1} }
        .slider-btn { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.9); color: #000; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; z-index: 10; display: flex; align-items: center; justify-content: center; transition: all 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .slider-btn:hover { background: #D4AF37; color: white; }
        .dot.active { background: #D4AF37; width: 18px; border-radius: 3px; }
        #lightbox { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.95); justify-content: center; align-items: center; }
        #lightbox img { max-width: 90%; max-height: 90%; object-fit: contain; border: 2px solid #D4AF37; }
        #link-loader { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:white; z-index: 9000; justify-content: center; align-items: center; flex-direction: column; }
        #share-canvas { display: none; }
        .btn-loading { opacity: 0.5; pointer-events: none; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 antialiased selection:bg-brand-maroon selection:text-white">

    <div id="link-loader">
        <i class="fas fa-circle-notch fa-spin text-brand-gold text-5xl mb-4"></i>
        <p class="text-brand-dark font-serif font-bold text-xl">Searching Inventory...</p>
    </div>

    <!-- Navigation & Hero Sections (Omitted for brevity, matches V22 layout) -->
    <!-- [Include your full Navigation, Hero, and About sections here as in V22] -->

    <!-- Products Section -->
    <section id="products" class="py-24 bg-brand-light border-y border-gray-200">
        <div class="container mx-auto px-6">
            <div class="text-center mb-16">
                <span class="text-brand-maroon font-bold uppercase tracking-widest text-xs">Catalog</span>
                <h2 class="text-4xl font-serif font-bold text-brand-dark mt-3">Product Categories</h2>
                <div class="h-1 w-20 bg-brand-gold mx-auto mt-6"></div>
            </div>
            <div id="tiles-container" class="grid grid-cols-1 md:grid-cols-3 gap-8"></div>
        </div>
    </section>

    <!-- [Include Footer and Modals as in V22] -->

    <canvas id="share-canvas"></canvas>

    <script>
        const SHEET_ID = '1-s7frQnY1Muh4XOizcz2V3KnkkHV8owNWYzyDrYFSic'; 
        const BASE_URL = 'https://animalhealth.pk'; 
        let allProducts = [];

        async function fetchProducts() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('item')) document.getElementById('link-loader').style.display = 'flex';
            const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;
            try {
                const response = await fetch(url);
                const text = await response.text();
                allProducts = parseCSV(text);
                generateTiles();
                checkForDirectLink();
            } catch (error) { console.error(error); }
        }

        // SLUG LOGIC matches Python Bot
        function getCleanSlug(name) {
            if(!name) return '';
            return name.toLowerCase().replace(/&/g, 'and').replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
        }

        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const result = [];
            for (let i = 1; i < lines.length; i++) {
                const row = lines[i]; if (!row) continue;
                const regex = /"([^"]*)"|([^,]+)|(?<=,)(?=,)/g; 
                const matches = row.match(regex);
                if (matches && matches.length >= 2) {
                    const clean = matches.map(m => m ? m.replace(/^"|"$/g, '').trim() : '');
                    result.push({ category: clean[0].toLowerCase().trim(), name: clean[1], desc: clean[2] || '', images: (clean[3] || '').split(',').map(url => url.trim()).filter(url => url.length > 5) });
                }
            }
            return result;
        }

        function generateTiles() {
            const uniqueCats = [...new Set(allProducts.map(p => p.category))];
            const container = document.getElementById('tiles-container');
            container.innerHTML = uniqueCats.map(cat => `
                <div onclick="openCategoryModal('${cat}')" class="group cursor-pointer bg-white p-10 shadow-sleek hover:shadow-2xl transition transform hover:-translate-y-2 relative border-b-4 border-transparent hover:border-brand-gold">
                    <h3 class="text-2xl font-serif font-bold text-brand-dark mb-3 capitalize">${cat}</h3>
                    <div class="mt-8 flex items-center text-brand-maroon font-bold text-xs uppercase tracking-widest group-hover:text-brand-gold transition">
                        View Products <i class="fas fa-long-arrow-alt-right ml-2"></i>
                    </div>
                </div>`).join('');
        }

        window.openCategoryModal = (category, specificItemName = null) => {
            const grid = document.getElementById('modal-grid');
            document.getElementById('modal-title').innerText = specificItemName ? 'Product Details' : category;
            let filtered = allProducts.filter(p => p.category === category);
            if(specificItemName) {
                filtered = allProducts.filter(p => getCleanSlug(p.name) === getCleanSlug(specificItemName));
            }
            grid.innerHTML = filtered.map((p, index) => {
                const slug = getCleanSlug(p.name);
                const cleanRedirectLink = `animalhealth.pk/s/${slug}.html`;
                const imageLink = p.images[0] || '';
                return `
                <div class="bg-white border border-gray-100 shadow-sm hover:shadow-xl transition">
                    <div class="h-64 overflow-hidden bg-gray-50 border-b relative">
                        <img src="${imageLink}" class="w-full h-full object-contain">
                    </div>
                    <div class="p-6">
                        <h4 class="font-bold text-brand-dark mb-2 font-serif">${p.name}</h4>
                        <div class="grid grid-cols-2 gap-2 mt-4">
                            <button onclick="shareProductNative(event, '${p.name.replace(/'/g,"\\'")}', '${p.category}', '${p.desc.replace(/'/g,"\\'").replace(/\n/g,'\\n')}', '${imageLink}')" class="bg-brand-gold text-brand-dark py-3 text-[10px] font-bold uppercase transition"><i class="fas fa-share-alt mr-1"></i> SHARE</button>
                            <a href="https://wa.me/923352999006?text=${encodeURIComponent('ðŸ“¦ *Product:* ' + p.name + '\nðŸ”— *Link:* ' + cleanRedirectLink)}" target="_blank" class="bg-brand-maroon text-white py-3 text-[10px] font-bold uppercase text-center"><i class="fab fa-whatsapp mr-1"></i> INQUIRE</a>
                        </div>
                    </div>
                </div>`;
            }).join('');
            document.getElementById('category-modal').classList.remove('hidden');
        };

        window.shareProductNative = async (event, name, cat, desc, imgUrl) => {
            const btn = event.currentTarget;
            const slug = getCleanSlug(name);
            const redirectLink = `animalhealth.pk/s/${slug}.html`;
            const cleanDesc = desc.replace(/<[^>]*>?/gm, ''); 
            const caption = `ðŸ“¦ *Product:* ${name}\nðŸ“‚ *Category:* ${cat.toUpperCase()}\nðŸ“ *Details:* ${cleanDesc}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nðŸ”— *Link:* ${redirectLink}`;
            const fallbackCaption = `ðŸ“¦ *Product:* ${name}\nðŸ“‚ *Category:* ${cat.toUpperCase()}\nðŸ“ *Details:* ${cleanDesc}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nðŸ–¼ *Image:* ${imgUrl}\nðŸ”— *Link:* ${redirectLink}`;

            btn.classList.add('btn-loading');
            try {
                if (imgUrl && navigator.canShare && navigator.share) {
                    const tempImg = new Image(); tempImg.crossOrigin = "anonymous"; tempImg.src = imgUrl + '?t=' + new Date().getTime(); 
                    await new Promise((res, rej) => { tempImg.onload = res; tempImg.onerror = rej; setTimeout(rej, 4000); });
                    const canvas = document.getElementById('share-canvas'); canvas.width = tempImg.width; canvas.height = tempImg.height;
                    canvas.getContext('2d').drawImage(tempImg, 0, 0);
                    const blob = await new Promise(res => canvas.toBlob(res, 'image/jpeg', 0.8));
                    const file = new File([blob], `${slug}.jpg`, { type: 'image/jpeg' });
                    if (navigator.canShare({ files: [file] })) { await navigator.share({ files: [file], text: caption }); btn.classList.remove('btn-loading'); return; }
                }
                if (navigator.share) await navigator.share({ text: fallbackCaption });
                else { await navigator.clipboard.writeText(fallbackCaption); alert("Details copied!"); }
            } catch (e) { window.open(`https://wa.me/?text=${encodeURIComponent(fallbackCaption)}`, '_blank'); }
            btn.classList.remove('btn-loading');
        };

        function checkForDirectLink() {
            const item = new URLSearchParams(window.location.search).get('item');
            if (item) {
                const product = allProducts.find(p => getCleanSlug(p.name) === getCleanSlug(item));
                document.getElementById('link-loader').style.display = 'none';
                if (product) openCategoryModal(product.category, product.name);
            } else document.getElementById('link-loader').style.display = 'none';
        }

        fetchProducts();
    </script>
</body>
</html>
